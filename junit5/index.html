<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta content="Thomas Lehmann &lt;thomas.lehmann.private@gmail.com" name="author"/>
<link href="https://thomas-lehmann-private.github.io/hyperion/junit5/" rel="canonical"/>
<link href="../img/favicon.ico" rel="shortcut icon"/>
<title>JUnit5 - Hyperion</title>
<link href="../css/bootstrap.min.css" rel="stylesheet"/>
<link href="../css/font-awesome.min.css" rel="stylesheet"/>
<link href="../css/base.css" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/docco.min.css" rel="stylesheet"/>
<script defer="" src="../js/jquery-1.10.2.min.js"></script>
<script defer="" src="../js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
</head>
<body>
<div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
<div class="container">
<a class="navbar-brand" href="..">Hyperion</a>
<!-- Expander button -->
<button class="navbar-toggler" data-target="#navbar-collapse" data-toggle="collapse" type="button">
<span class="navbar-toggler-icon"></span>
</button>
<!-- Expanded navigation -->
<div class="navbar-collapse collapse" id="navbar-collapse">
<!-- Main navigation -->
<ul class="nav navbar-nav">
<li class="navitem">
<a class="nav-link" href="..">Home</a>
</li>
<li class="dropdown">
<a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#">User Guide <b class="caret"></b></a>
<ul class="dropdown-menu">
<li>
<a class="dropdown-item" href="../hyperion/">Application</a>
</li>
<li>
<a class="dropdown-item" href="../taskgroup/">Taskgroup</a>
</li>
<li>
<a class="dropdown-item" href="../basic-task-features/">Basic tasks features</a>
</li>
<li>
<a class="dropdown-item" href="../basic-coded-task-features/">Basic code tasks</a>
</li>
<li>
<a class="dropdown-item" href="../groovy/">Groovy task</a>
</li>
<li>
<a class="dropdown-item" href="../powershell/">Powershell task</a>
</li>
<li>
<a class="dropdown-item" href="../windows-batch/">Windows Batch task</a>
</li>
<li>
<a class="dropdown-item" href="../shell/">Shell task</a>
</li>
<li>
<a class="dropdown-item" href="../docker-image/">Docker image task</a>
</li>
<li>
<a class="dropdown-item" href="../docker-container/">Docker container task</a>
</li>
<li>
<a class="dropdown-item" href="../copy-file/">File copy task</a>
</li>
<li>
<a class="dropdown-item" href="../templating/">Templating</a>
</li>
<li>
<a class="dropdown-item" href="../matrix/">Matrix</a>
</li>
</ul>
</li>
<li class="dropdown active">
<a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#">Developer Guide <b class="caret"></b></a>
<ul class="dropdown-menu">
<li>
<a class="dropdown-item" href="../requirements/">Requirements</a>
</li>
<li>
<a class="dropdown-item" href="../build/">Build</a>
</li>
<li>
<a class="dropdown-item active" href="./">JUnit5</a>
</li>
<li>
<a class="dropdown-item" href="../mkdocs/">Mkdocs</a>
</li>
<li>
<a class="dropdown-item" href="../cli/">CLI</a>
</li>
<li>
<a class="dropdown-item" href="../finishing-a-milestone/">Finishing a milestone</a>
</li>
</ul>
</li>
</ul>
<ul class="nav navbar-nav ml-auto">
<li class="nav-item">
<a class="nav-link" data-target="#mkdocs_search_modal" data-toggle="modal" href="#">
<i class="fa fa-search"></i> Search
                            </a>
</li>
<li class="nav-item">
<a class="nav-link" href="../build/" rel="prev">
<i class="fa fa-arrow-left"></i> Previous
                                </a>
</li>
<li class="nav-item">
<a class="nav-link" href="../mkdocs/" rel="next">
                                    Next <i class="fa fa-arrow-right"></i>
</a>
</li>
<li class="nav-item">
<a class="nav-link" href="https://github.com/thomas-lehmann-private/hyperion/edit/master/docs/junit5.md"><i class="fa fa-github"></i> Edit on GitHub</a>
</li>
</ul>
</div>
</div>
</div>
<div class="container">
<div class="row">
<div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
<div class="navbar-header">
<button class="navbar-toggler collapsed" data-target="#toc-collapse" data-toggle="collapse" title="Table of Contents" type="button">
<span class="fa fa-angle-down"></span>
</button>
</div>
<div class="navbar-collapse collapse card bg-secondary" id="toc-collapse">
<ul class="nav flex-column">
<li class="nav-item" data-level="1"><a class="nav-link" href="#junit5">JUnit5</a>
<ul class="nav flex-column">
<li class="nav-item" data-level="2"><a class="nav-link" href="#default-test-methods">Default test methods</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-level="2"><a class="nav-link" href="#assertions">Assertions</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-level="2"><a class="nav-link" href="#parameterized-tests">Parameterized tests</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-level="2"><a class="nav-link" href="#how-it-looks-like-in-an-ide">How it looks like in an IDE</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-level="2"><a class="nav-link" href="#assuming">Assuming</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-level="2"><a class="nav-link" href="#os-specific-tests">OS specific tests</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-level="2"><a class="nav-link" href="#code-coverage">Code Coverage</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-level="2"><a class="nav-link" href="#order-of-test-methods">Order of test methods</a>
<ul class="nav flex-column">
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div></div>
<div class="col-md-9" role="main">
<h1 id="junit5">JUnit5</h1>
<p>The setup of Junit5 is explained here: <a href="../build/">Build</a>.</p>
<h2 id="default-test-methods">Default test methods</h2>
<p>There is not much to say since the annotation <strong>@Test</strong> is the same
as for Junit4. However one fact is important: <mark>If you use
<strong>@ParameterizedTest</strong> you cannot use <strong>@Test</strong></mark>.</p>
<h2 id="assertions">Assertions</h2>
<p>The assertions of Junit5 are a lot to feel comfortable;
after here some of them I have used:</p>
<table>
<thead>
<tr>
<th>Assertion</th>
<th>Meaning</th>
<th>Context</th>
</tr>
</thead>
<tbody>
<tr>
<td>assertEquals</td>
<td>Comparing two things to be equal</td>
<td>values</td>
</tr>
<tr>
<td>assertNotEquals</td>
<td>Comparing two things to be unequal</td>
<td>values</td>
</tr>
<tr>
<td>assertTrue</td>
<td>Verify that a condition evaluates to true</td>
<td>condition/state</td>
</tr>
<tr>
<td>assertFalse</td>
<td>Verify that a condition evaluates to false</td>
<td>condition/state</td>
</tr>
<tr>
<td>assertNull</td>
<td>Verify that an instance of something is null</td>
<td>instance</td>
</tr>
<tr>
<td>assertNotNull</td>
<td>Verify that an instance of something is not null</td>
<td>instance</td>
</tr>
<tr>
<td>assertThrows</td>
<td>Verify that a concrete exception has been thrown</td>
<td>exception</td>
</tr>
<tr>
<td>assertDoesNotThrow</td>
<td>Verify that no exception is thrown.</td>
<td>exception</td>
</tr>
<tr>
<td>assumeTrue</td>
<td>When condition is false the test is marked as ignored</td>
<td>run/ignore test</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Each variant is provided a second one where you can provide a helpful
message that is shown when the assertion is thrown.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <strong>assertThrows</strong> also provides the throwable that you additional can
verify that the concrete message is thrown or whatever information you
have passed to your exception.</p>
</div>
<h2 id="parameterized-tests">Parameterized tests</h2>
<p>Parameterized tests are a nice way to write a test method once calling
it several times for different data input. In the list of tests each
variant appears individually given you a clear idea which of the variant
has failed.</p>
<pre><code class="java">    /**
     * Testing validation of the long name.
     *
     * @param bExpectedToFail when true then expected to fail.
     * @param strValue value for long name.
     * @param strMessage hint for the case the assertion does fail.
     */
    @ParameterizedTest(
            name = "test long name - #{index} expected to fail={0}, value={1}, message={2}")
    @MethodSource("provideLongNameValidationTestData")
    public void testLongNameValidation(
            final boolean bExpectedToFail,
            final String strValue,
            final String strMessage) {
        // setup of builder
        final var builder = CliOption.builder();
        builder.setShortName("x");
        builder.setDescription("test");
        builder.setLongName(strValue);

        if (bExpectedToFail) {
            assertThrows(CliException.class, builder::build, strMessage);
        } else {
            assertDoesNotThrow(builder::build, strMessage);
        }
    }
</code></pre>
<p>The given code is taken from Hyperion and you can see following:</p>
<ul>
<li>The annotation <strong>@ParametrerizedTest</strong> with the name value specifying how
   the test is displayed in the IDE. The curly braces are substituted by the
   values passes as parameters to the test function. The <strong>{index}</strong> is a
   special parameter to allow the visualize the nth call of the test method.</li>
<li>The annotation <strong>@MethodSource</strong> is to specify a static method that does
   provide the test data.</li>
<li>For being able to control how the assertion should work a boolean is passed
   as well telling the method what kind of assertion is wanted. In given example
   there is an exception thrown when the test is expected to fail otherwise it will
   be verified that no exception is thrown when test is expected to succeed.</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It's to say that the visualization of the parameterized test does
not necessarily work on all IDE. That's why I have been switching to Intellij
where it is working well.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The annotation <strong>@DisplayName</strong> doesn't work well in the IDE (for now) on
the test method; that's why I did place a name in front of the index.</p>
<p>However it has to be placed on the class otherwise the Maven build shows
<strong>null</strong> instead of the class name.</p>
</div>
<p>The following code is the relating function providing the test data:</p>
<pre><code class="java">    /**
     * Test data for long name validation.
     *
     * @return test data.
     */
    private static Stream&lt;Arguments&gt; provideLongNameValidationTestData() {
        //CHECKSTYLE.OFF: MultipleStringLiterals - ok here.
        return Stream.of(
                Arguments.of(true, null, "cannot be null"),
                Arguments.of(true, "FILE", "cannot be uppercase letters"),
                Arguments.of(true, "f", "too short"),
                Arguments.of(true, "abcdefghijklmnop", "too long"),
                Arguments.of(false, "abcdefghijklmno",
                        "maximum length for one subname"),
                Arguments.of(false, "config-file", "two valid sub names"),
                Arguments.of(false, "config-file-path", "three valid sub names"),
                Arguments.of(true, "the-config-file-path",
                        "limited to three sub names"),
                Arguments.of(true, "abcdefghijklmno-abcdefghijklmnop",
                        "second subname too long"),
                Arguments.of(true, "abcdefghijklmno-a",
                        "second subname too short"),
                Arguments.of(true,
                        "abcdefghijklmno-abcdefghijklmno-abcdefghijklmnop",
                        "third subname too long"),
                Arguments.of(true, "abcdefghijklmno-abcdefghijklmno-a",
                        "third subname too short"),
                Arguments.of(false, "http2", "allows number at the end"),
                Arguments.of(true, "2http", "name cannot start with numbers"),
                Arguments.of(false, "ht2tp", "allows numbers in name"),
                Arguments.of(true, "abc!?-_[](),;.",
                        "cannot be special characters")
        );
        //CHECKSTYLE.ON: MultipleStringLiterals
    }
</code></pre>
<p>Following information should be recognized:</p>
<ul>
<li>The function is - of course - private and <strong>it must be static</strong>.</li>
<li>The return value is a <strong>Stream<arguments></arguments></strong>!</li>
<li>The function does return a <strong>Stream()</strong> something.</li>
<li>Each entry enforces a call of the test method and the parameters
   for one call are <strong>Arguments.of()</strong> something.</li>
<li>You don't need to but I organized to have the explaining message
   as one parameter. It appears in the list of tests as parameters as well
   as it is shown for the case that the test does fail because the
   message is passed to the.</li>
</ul>
<h2 id="how-it-looks-like-in-an-ide">How it looks like in an IDE</h2>
<p><img alt="parameterized-tests.png" src="../images/parameterized-tests.png"/></p>
<h2 id="assuming">Assuming</h2>
<p>You might have the problem that a test depends on a certain setup of
the system. Let's say you do not have Docker installed on your system
then this test detects that and the concrete assertion will automatically
mark the tests as ignored.</p>
<pre><code class="java">@Test
public void testDockerForTargetUnix() {
    assumeTrue(Capabilities.hasDocker());
    // test code
}
</code></pre>
<h2 id="os-specific-tests">OS specific tests</h2>
<p>There are test that can run on specific systems only. JUnit5
is capable to detect the system and you can use the annotation
<strong>@EnabledOnOs</strong> to specify on which system the test should run.</p>
<pre><code class="java">@DisplayName("Testing UnixShellTask")
@EnabledOnOs({OS.LINUX, OS.MAC})
public class UnixShellTaskTest {
    // test code
}
</code></pre>
<p>and</p>
<pre><code class="java">@DisplayName("Testing WindowsBatchTask")
@EnabledOnOs(OS.WINDOWS)
public class WindowsBatchTaskTest {
    // test code
}
</code></pre>
<h2 id="code-coverage">Code Coverage</h2>
<p>Also explained in <a href="../build/">Build</a> the awareness should here be raised
that unit tests running on multiple environments and multiple platforms
might lead to multiple coverage results. On Windows the class <strong>UnixShellTask</strong>
is not tested (as an example). There for you can organize a profile
which - at least - allows you to have different coverage limits depending
on the platform.</p>
<h2 id="order-of-test-methods">Order of test methods</h2>
<p>It's not obvious but there is an algorithm defining an order.
However tests should be independent and therefor a random order is probably
a better solution:</p>
<pre><code class="java">@DisplayName("Testing of CliOption class")
@TestMethodOrder(value = MethodOrderer.Random.class)
public class CliOptionTest {
    // test code
}
</code></pre>
<div class="admonition note">
<p class="admonition-title">Please note</p>
<p>When a test fails the logging prints the seed that has been used to run
the methods in random order that you are able to re-run the tests in same
order when the problem did arrive. You have to set the property 
<strong>junit.jupiter.execution.order.random.seed</strong> then.</p>
</div>
<p>It's also possible to define random order of test classes.
That can be defined in the pom.xml at the <strong>surefire</strong> Maven plugin
with the configuration option <code>&lt;runOrder&gt;random&lt;/runOrder&gt;</code>.</p></div>
</div>
</div>
<footer class="col-md-12">
<hr/>
<p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
</footer>
<script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
<script defer="" src="../js/base.js"></script>
<script defer="" src="../search/main.js"></script>
<div aria-hidden="true" aria-labelledby="searchModalLabel" class="modal" id="mkdocs_search_modal" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg">
<div class="modal-content">
<div class="modal-header">
<h4 class="modal-title" id="searchModalLabel">Search</h4>
<button class="close" data-dismiss="modal" type="button"><span aria-hidden="true">×</span><span class="sr-only">Close</span></button>
</div>
<div class="modal-body">
<p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
<form>
<div class="form-group">
<input class="form-control" id="mkdocs-search-query" placeholder="Search..." title="Type search term here" type="search"/>
</div>
</form>
<div id="mkdocs-search-results"></div>
</div>
<div class="modal-footer">
</div>
</div>
</div>
</div><div aria-hidden="true" aria-labelledby="keyboardModalLabel" class="modal" id="mkdocs_keyboard_modal" role="dialog" tabindex="-1">
<div class="modal-dialog">
<div class="modal-content">
<div class="modal-header">
<h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
<button class="close" data-dismiss="modal" type="button"><span aria-hidden="true">×</span><span class="sr-only">Close</span></button>
</div>
<div class="modal-body">
<table class="table">
<thead>
<tr>
<th style="width: 20%;">Keys</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr>
<td class="help shortcut"><kbd>?</kbd></td>
<td>Open this help</td>
</tr>
<tr>
<td class="next shortcut"><kbd>n</kbd></td>
<td>Next page</td>
</tr>
<tr>
<td class="prev shortcut"><kbd>p</kbd></td>
<td>Previous page</td>
</tr>
<tr>
<td class="search shortcut"><kbd>s</kbd></td>
<td>Search</td>
</tr>
</tbody>
</table>
</div>
<div class="modal-footer">
</div>
</div>
</div>
</div>
</body>
</html>
