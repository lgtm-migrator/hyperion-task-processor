<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta content="Thomas Lehmann &lt;thomas.lehmann.private@gmail.com" name="author"/>
<link href="https://thomas-lehmann-private.github.io/hyperion-task-processor/internal/implementing-a-new-task/" rel="canonical"/>
<link href="../../img/favicon.ico" rel="shortcut icon"/>
<title>Implementing a new task - Hyperion Task Processor</title>
<link href="../../css/bootstrap.min.css" rel="stylesheet"/>
<link href="../../css/font-awesome.min.css" rel="stylesheet"/>
<link href="../../css/base.css" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/docco.min.css" rel="stylesheet"/>
<script defer="" src="../../js/jquery-1.10.2.min.js"></script>
<script defer="" src="../../js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
</head>
<body>
<div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
<div class="container">
<a class="navbar-brand" href="../..">Hyperion Task Processor</a>
<!-- Expander button -->
<button class="navbar-toggler" data-target="#navbar-collapse" data-toggle="collapse" type="button">
<span class="navbar-toggler-icon"></span>
</button>
<!-- Expanded navigation -->
<div class="navbar-collapse collapse" id="navbar-collapse">
<!-- Main navigation -->
<ul class="nav navbar-nav">
<li class="navitem">
<a class="nav-link" href="../..">Home</a>
</li>
<li class="dropdown">
<a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#">User Guide <b class="caret"></b></a>
<ul class="dropdown-menu">
<li>
<a class="dropdown-item" href="../../hyperion-task-processor/">Application</a>
</li>
<li>
<a class="dropdown-item" href="../../taskgroup/">Taskgroup</a>
</li>
<li>
<a class="dropdown-item" href="../../basic-task-features/">Basic tasks features</a>
</li>
<li>
<a class="dropdown-item" href="../../basic-coded-task-features/">Basic code tasks</a>
</li>
<li>
<a class="dropdown-item" href="../../groovy/">Groovy task</a>
</li>
<li>
<a class="dropdown-item" href="../../powershell/">Powershell task</a>
</li>
<li>
<a class="dropdown-item" href="../../windows-batch/">Windows Batch task</a>
</li>
<li>
<a class="dropdown-item" href="../../shell/">Shell task</a>
</li>
<li>
<a class="dropdown-item" href="../../docker-image/">Docker image task</a>
</li>
<li>
<a class="dropdown-item" href="../../docker-container/">Docker container task</a>
</li>
<li>
<a class="dropdown-item" href="../../copy-file/">File copy task</a>
</li>
<li>
<a class="dropdown-item" href="../../write-file/">Write File Task</a>
</li>
<li>
<a class="dropdown-item" href="../../download-task/">Download Task</a>
</li>
<li>
<a class="dropdown-item" href="../../xsl-transform/">XSL Transform Task</a>
</li>
<li>
<a class="dropdown-item" href="../../templating/">Templating</a>
</li>
<li>
<a class="dropdown-item" href="../../matrix/">Matrix</a>
</li>
<li>
<a class="dropdown-item" href="../../rest-api/">REST api</a>
</li>
<li>
<a class="dropdown-item" href="../../python/">Python task</a>
</li>
</ul>
</li>
<li class="dropdown active">
<a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#">Developer Guide <b class="caret"></b></a>
<ul class="dropdown-menu">
<li>
<a class="dropdown-item" href="../../requirements/">Requirements</a>
</li>
<li>
<a class="dropdown-item" href="../build/">Build</a>
</li>
<li>
<a class="dropdown-item" href="../junit5/">JUnit5</a>
</li>
<li>
<a class="dropdown-item" href="../mkdocs/">Mkdocs</a>
</li>
<li>
<a class="dropdown-item" href="../cli/">CLI</a>
</li>
<li>
<a class="dropdown-item" href="../finishing-a-milestone/">Finishing a milestone</a>
</li>
<li>
<a class="dropdown-item active" href="./">Implementing a new task</a>
</li>
</ul>
</li>
</ul>
<ul class="nav navbar-nav ml-auto">
<li class="nav-item">
<a class="nav-link" data-target="#mkdocs_search_modal" data-toggle="modal" href="#">
<i class="fa fa-search"></i> Search
                            </a>
</li>
<li class="nav-item">
<a class="nav-link" href="../finishing-a-milestone/" rel="prev">
<i class="fa fa-arrow-left"></i> Previous
                                </a>
</li>
<li class="nav-item">
<a class="nav-link disabled" rel="next">
                                    Next <i class="fa fa-arrow-right"></i>
</a>
</li>
<li class="nav-item">
<a class="nav-link" href="https://github.com/thomas-lehmann-private/hyperion-task-processor/edit/master/docs/internal/implementing-a-new-task.md"><i class="fa fa-github"></i> Edit on GitHub</a>
</li>
</ul>
</div>
</div>
</div>
<div class="container">
<div class="row">
<div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
<div class="navbar-header">
<button class="navbar-toggler collapsed" data-target="#toc-collapse" data-toggle="collapse" title="Table of Contents" type="button">
<span class="fa fa-angle-down"></span>
</button>
</div>
<div class="navbar-collapse collapse card bg-secondary" id="toc-collapse">
<ul class="nav flex-column">
<li class="nav-item" data-level="1"><a class="nav-link" href="#implementing-a-new-task">Implementing a new task</a>
<ul class="nav flex-column">
<li class="nav-item" data-level="2"><a class="nav-link" href="#introduction">Introduction</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-level="2"><a class="nav-link" href="#overview">Overview</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-level="2"><a class="nav-link" href="#required-constants">Required Constants</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-level="2"><a class="nav-link" href="#implementing-the-task">Implementing the task</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-level="2"><a class="nav-link" href="#implementing-the-task-creator">Implementing the task creator</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-level="2"><a class="nav-link" href="#implementing-the-task-reader">Implementing the task reader</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-level="2"><a class="nav-link" href="#implementing-the-task-reader-creator">Implementing the task reader creator</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-level="2"><a class="nav-link" href="#testing">Testing</a>
<ul class="nav flex-column">
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div></div>
<div class="col-md-9" role="main">
<h1 id="implementing-a-new-task">Implementing a new task</h1>
<h2 id="introduction">Introduction</h2>
<p>Writing a new task is getting easier by each new task because the given code offers more
and more reusable functionality. That means you also have to rethink the design.
In addition the static code analysis is a great help forcing you to rethink when
duplicate code has been detected or one class does have to many dependencies to other
classes. This article intends to explain how the DownloadTask has been implemented
providing you an example.</p>
<h2 id="overview">Overview</h2>
<p><span class="graphviz-light-dark" data-dark="#ffffff" data-default="#789abc" data-library-default="#789abc" data-light="#000000"></span><svg class="graphviz dot" height="179pt" viewbox="0.00 0.00 1827.00 179.00" width="1827pt" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g class="graph" id="graph0" transform="scale(1 1) rotate(0) translate(4 175)"><title>G</title><polygon fill="transparent" points="-4,4 -4,-175 1823,-175 1823,4 -4,4" stroke="transparent"></polygon><!-- TaskReaderFactory --><g class="node" id="node1"><title>TaskReaderFactory</title><polygon fill="none" points="446,-36 169,-36 169,0 446,0 446,-36" stroke="#789abc"></polygon><text fill="#789abc" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="307.5" y="-14.3">Factory&lt;AbstractBasicTaskReader&gt;</text></g><!-- DownloadTaskReaderCreator --><g class="node" id="node6"><title>DownloadTaskReaderCreator</title><polygon fill="orange" points="792,-63 567,-63 567,-27 792,-27 792,-63" stroke="#789abc"></polygon><text fill="#789abc" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="679.5" y="-41.3">DownloadTaskReaderCreator</text></g><!-- TaskReaderFactory&#45;&gt;DownloadTaskReaderCreator --><g class="edge" id="edge10"><title>TaskReaderFactory-&gt;DownloadTaskReaderCreator</title><path d="M446.18,-27.58C479.82,-29.96 515.71,-32.54 549,-35 551.56,-35.19 554.14,-35.38 556.75,-35.58" fill="none" stroke="#789abc" stroke-dasharray="5,2"></path><polygon fill="#789abc" points="556.66,-39.08 566.89,-36.34 557.18,-32.1 556.66,-39.08" stroke="#789abc"></polygon><text fill="#789abc" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="506.5" y="-38.8">creates</text></g><!-- TaskFactory --><g class="node" id="node2"><title>TaskFactory</title><polygon fill="none" points="1049,-63 861,-63 861,-27 1049,-27 1049,-63" stroke="#789abc"></polygon><text fill="#789abc" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="955" y="-41.3">Factory&lt;AbstractTask&gt;</text></g><!-- DownloadTaskReader --><g class="node" id="node5"><title>DownloadTaskReader</title><polygon fill="orange" points="1312,-90 1142,-90 1142,-54 1312,-54 1312,-90" stroke="#789abc"></polygon><text fill="#789abc" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="1227" y="-68.3">DownloadTaskReader</text></g><!-- TaskFactory&#45;&gt;DownloadTaskReader --><g class="edge" id="edge8"><title>TaskFactory-&gt;DownloadTaskReader</title><path d="M1049.3,-54.33C1075.92,-56.99 1104.95,-59.89 1131.64,-62.56" fill="none" stroke="#789abc" stroke-dasharray="5,2"></path><polygon fill="#789abc" points="1131.45,-66.06 1141.74,-63.57 1132.14,-59.1 1131.45,-66.06" stroke="#789abc"></polygon><text fill="#789abc" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="1095.5" y="-64.8">creates</text></g><!-- DownloadTask --><g class="node" id="node3"><title>DownloadTask</title><polygon fill="orange" points="1819,-144 1700,-144 1700,-108 1819,-108 1819,-144" stroke="#789abc"></polygon><text fill="#789abc" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="1759.5" y="-122.3">DownloadTask</text></g><!-- DownloadTaskCreator --><g class="node" id="node4"><title>DownloadTaskCreator</title><polygon fill="orange" points="1607,-117 1433,-117 1433,-81 1607,-81 1607,-117" stroke="#789abc"></polygon><text fill="#789abc" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="1520" y="-95.3">DownloadTaskCreator</text></g><!-- DownloadTaskCreator&#45;&gt;DownloadTask --><g class="edge" id="edge2"><title>DownloadTaskCreator-&gt;DownloadTask</title><path d="M1607.14,-106.86C1631.38,-109.26 1657.74,-112.05 1682,-115 1684.51,-115.3 1687.06,-115.62 1689.63,-115.95" fill="none" stroke="#789abc" stroke-dasharray="5,2"></path><polygon fill="#789abc" points="1689.27,-119.44 1699.65,-117.27 1690.19,-112.5 1689.27,-119.44" stroke="#789abc"></polygon><text fill="#789abc" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="1653.5" y="-118.8">creates</text></g><!-- DownloadTaskReader&#45;&gt;DownloadTaskCreator --><g class="edge" id="edge5"><title>DownloadTaskReader-&gt;DownloadTaskCreator</title><path d="M1312.17,-79.81C1346.77,-83.02 1387.03,-86.76 1422.79,-90.07" fill="none" stroke="#789abc" stroke-dasharray="5,2"></path><polygon fill="#789abc" points="1422.47,-93.56 1432.75,-91 1423.11,-86.59 1422.47,-93.56" stroke="#789abc"></polygon><text fill="#789abc" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="1372.5" y="-91.8">uses</text></g><!-- DownloadTaskReaderCreator&#45;&gt;TaskFactory --><g class="edge" id="edge7"><title>DownloadTaskReaderCreator-&gt;TaskFactory</title><path d="M792.14,-45C811.42,-45 831.39,-45 850.45,-45" fill="none" stroke="#789abc" stroke-dasharray="5,2"></path><polygon fill="#789abc" points="850.62,-48.5 860.62,-45 850.62,-41.5 850.62,-48.5" stroke="#789abc"></polygon><text fill="#789abc" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="826.5" y="-48.8">uses</text></g><!-- AbstractFileTask --><g class="node" id="node7"><title>AbstractFileTask</title><polygon fill="none" points="1588.5,-171 1451.5,-171 1451.5,-135 1588.5,-135 1588.5,-171" stroke="#789abc"></polygon><text fill="#789abc" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="1520" y="-149.3">AbstractFileTask</text></g><!-- AbstractFileTask&#45;&gt;DownloadTask --><g class="edge" id="edge1"><title>AbstractFileTask-&gt;DownloadTask</title><path d="M1598.79,-144.16C1631.72,-140.41 1669.44,-136.13 1699.94,-132.66" fill="none" stroke="#789abc"></path><polygon fill="#789abc" points="1598.28,-140.69 1588.74,-145.3 1599.07,-147.65 1598.28,-140.69" stroke="#789abc"></polygon><text fill="#789abc" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="1653.5" y="-144.8">extends</text></g><!-- ITaskCreator --><g class="node" id="node8"><title>ITaskCreator</title><polygon fill="none" points="1281.5,-144 1172.5,-144 1172.5,-108 1281.5,-108 1281.5,-144" stroke="#789abc"></polygon><text fill="#789abc" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="1227" y="-122.3">ITaskCreator</text></g><!-- ITaskCreator&#45;&gt;DownloadTaskCreator --><g class="edge" id="edge3"><title>ITaskCreator-&gt;DownloadTaskCreator</title><path d="M1291.93,-120.07C1333.27,-116.23 1387.6,-111.19 1432.74,-107" fill="none" stroke="#789abc"></path><polygon fill="#789abc" points="1291.35,-116.61 1281.71,-121.02 1291.99,-123.58 1291.35,-116.61" stroke="#789abc"></polygon><text fill="#789abc" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="1372.5" y="-119.8">implements</text></g><!-- AbstractFileTaskReader --><g class="node" id="node9"><title>AbstractFileTaskReader</title><polygon fill="none" points="1049,-117 861,-117 861,-81 1049,-81 1049,-117" stroke="#789abc"></polygon><text fill="#789abc" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="955" y="-95.3">AbstractFileTaskReader</text></g><!-- AbstractFileTaskReader&#45;&gt;DownloadTaskReader --><g class="edge" id="edge4"><title>AbstractFileTaskReader-&gt;DownloadTaskReader</title><path d="M1059.25,-88.67C1086.52,-85.95 1115.61,-83.04 1141.74,-80.43" fill="none" stroke="#789abc"></path><polygon fill="#789abc" points="1058.9,-85.19 1049.3,-89.67 1059.6,-92.16 1058.9,-85.19" stroke="#789abc"></polygon><text fill="#789abc" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="1095.5" y="-90.8">extends</text></g><!-- ITaskReaderCreator --><g class="node" id="node10"><title>ITaskReaderCreator</title><polygon fill="none" points="387.5,-90 227.5,-90 227.5,-54 387.5,-54 387.5,-90" stroke="#789abc"></polygon><text fill="#789abc" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="307.5" y="-68.3">ITaskReaderCreator</text></g><!-- ITaskReaderCreator&#45;&gt;DownloadTaskReaderCreator --><g class="edge" id="edge6"><title>ITaskReaderCreator-&gt;DownloadTaskReaderCreator</title><path d="M397.86,-65.48C448.71,-61.77 512.85,-57.09 566.97,-53.14" fill="none" stroke="#789abc"></path><polygon fill="#789abc" points="397.59,-61.99 387.87,-66.21 398.1,-68.97 397.59,-61.99" stroke="#789abc"></polygon><text fill="#789abc" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="506.5" y="-63.8">implements</text></g><!-- TaskReader --><g class="node" id="node11"><title>TaskReader</title><polygon fill="none" points="100,-36 0,-36 0,0 100,0 100,-36" stroke="#789abc"></polygon><text fill="#789abc" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="50" y="-14.3">TaskReader</text></g><!-- TaskReader&#45;&gt;TaskReaderFactory --><g class="edge" id="edge9"><title>TaskReader-&gt;TaskReaderFactory</title><path d="M100.26,-18C117.48,-18 137.79,-18 158.85,-18" fill="none" stroke="#789abc" stroke-dasharray="5,2"></path><polygon fill="#789abc" points="158.9,-21.5 168.9,-18 158.9,-14.5 158.9,-21.5" stroke="#789abc"></polygon><text fill="#789abc" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="134.5" y="-21.8">uses</text></g></g></svg></p>
<p>The last graphic shows how the different classes are working together.
For the download class following classes have to be implemented in that order:</p>
<ul>
<li>DownloadTask</li>
<li>DownloadTaskCreator</li>
<li>DownloadTaskReader</li>
<li>DownloadTaskReaderCreator</li>
</ul>
<h2 id="required-constants">Required Constants</h2>
<p>For the different classes following enum classes have to be extended:</p>
<ul>
<li><strong>TaskType</strong> - that enum has entries representing the type of task. The value of
   each enum reflects also the concrete value used in the YAML document for the type attribute.
   It is also used for the factory mechanism to find task creators and task reader creators.
   For the two creator classes and reader the enum <strong>DOWNLOAD</strong> has been added. </li>
<li><strong>DocumentReaderFields</strong> - that enum has entries representing the different attributes used
   in a YAML document. The value of each enum reflects the exact name to be used in the YAML
   document. It is used by the different reader to validate the document.
   For the DownloadTaskReader the enum <strong>URL</strong> has been added.</li>
</ul>
<h2 id="implementing-the-task">Implementing the task</h2>
<p><span class="graphviz-light-dark" data-dark="#ffffff" data-default="#789abc" data-library-default="#789abc" data-light="#000000"></span><svg class="graphviz dot" height="152pt" viewbox="0.00 0.00 996.00 152.00" width="996pt" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g class="graph" id="graph0" transform="scale(1 1) rotate(0) translate(4 148)"><title>G</title><polygon fill="transparent" points="-4,4 -4,-148 992,-148 992,4 -4,4" stroke="transparent"></polygon><!-- DownloadTask --><g class="node" id="node1"><title>DownloadTask</title><polygon fill="orange" points="988,-90 869,-90 869,-54 988,-54 988,-90" stroke="#789abc"></polygon><text fill="#789abc" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="928.5" y="-68.3">DownloadTask</text></g><!-- Runnable --><g class="node" id="node2"><title>Runnable</title><polygon fill="none" points="315,-144 0,-144 0,-108 315,-108 315,-144" stroke="#789abc"></polygon><text fill="#789abc" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="157.5" y="-122.3">IRunnable&lt;TaskResult, TaskParameters&gt;</text></g><!-- AbstractTask --><g class="node" id="node5"><title>AbstractTask</title><polygon fill="none" points="546,-90 436,-90 436,-54 546,-54 546,-90" stroke="#789abc"></polygon><text fill="#789abc" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="491" y="-68.3">AbstractTask</text></g><!-- Runnable&#45;&gt;AbstractTask --><g class="edge" id="edge2"><title>Runnable-&gt;AbstractTask</title><path d="M325.13,-106.64C356.11,-102.16 388.13,-96.93 418,-91 423.83,-89.84 429.89,-88.49 435.91,-87.04" fill="none" stroke="#789abc"></path><polygon fill="#789abc" points="324.52,-103.19 315.11,-108.07 325.5,-110.12 324.52,-103.19" stroke="#789abc"></polygon><text fill="#789abc" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="375.5" y="-107.8">implements</text></g><!-- Copyable --><g class="node" id="node3"><title>Copyable</title><polygon fill="none" points="260,-90 55,-90 55,-54 260,-54 260,-90" stroke="#789abc"></polygon><text fill="#789abc" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="157.5" y="-68.3">ICopyable&lt;AbstractTask&gt;</text></g><!-- Copyable&#45;&gt;AbstractTask --><g class="edge" id="edge3"><title>Copyable-&gt;AbstractTask</title><path d="M270.5,-72C326.22,-72 391.01,-72 435.69,-72" fill="none" stroke="#789abc"></path><polygon fill="#789abc" points="270.21,-68.5 260.21,-72 270.21,-75.5 270.21,-68.5" stroke="#789abc"></polygon><text fill="#789abc" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="375.5" y="-75.8">implements</text></g><!-- Component --><g class="node" id="node4"><title>Component</title><polygon fill="none" points="206.5,-36 108.5,-36 108.5,0 206.5,0 206.5,-36" stroke="#789abc"></polygon><text fill="#789abc" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="157.5" y="-14.3">Component</text></g><!-- Component&#45;&gt;AbstractTask --><g class="edge" id="edge1"><title>Component-&gt;AbstractTask</title><path d="M216.81,-23.77C269.63,-29.5 349.44,-39.39 418,-53 423.83,-54.16 429.89,-55.51 435.91,-56.96" fill="none" stroke="#789abc"></path><polygon fill="#789abc" points="216.94,-20.27 206.62,-22.69 216.19,-27.23 216.94,-20.27" stroke="#789abc"></polygon><text fill="#789abc" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="375.5" y="-56.8">extends</text></g><!-- AbstractFileTask --><g class="node" id="node6"><title>AbstractFileTask</title><polygon fill="none" points="776,-90 639,-90 639,-54 776,-54 776,-90" stroke="#789abc"></polygon><text fill="#789abc" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="707.5" y="-68.3">AbstractFileTask</text></g><!-- AbstractTask&#45;&gt;AbstractFileTask --><g class="edge" id="edge4"><title>AbstractTask-&gt;AbstractFileTask</title><path d="M556.28,-72C582.37,-72 612.52,-72 638.93,-72" fill="none" stroke="#789abc"></path><polygon fill="#789abc" points="556.13,-68.5 546.13,-72 556.13,-75.5 556.13,-68.5" stroke="#789abc"></polygon><text fill="#789abc" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="592.5" y="-75.8">extends</text></g><!-- AbstractFileTask&#45;&gt;DownloadTask --><g class="edge" id="edge5"><title>AbstractFileTask-&gt;DownloadTask</title><path d="M786.54,-72C813.67,-72 843.61,-72 868.9,-72" fill="none" stroke="#789abc"></path><polygon fill="#789abc" points="786.29,-68.5 776.29,-72 786.29,-75.5 786.29,-68.5" stroke="#789abc"></polygon><text fill="#789abc" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="822.5" y="-75.8">extends</text></g></g></svg></p>
<p>For the concrete example the Download task is derived from the <strong>AbstractFileTask</strong> since there
are multiple tasks sharing same attributes like:</p>
<ul>
<li><strong>destination</strong> - mandatory string attribute - where to write the file to</li>
<li><strong>overwrite</strong> - optional boolean attribute - whether an existing file can be overwritten (default is false)</li>
<li><strong>ensure-path</strong> - optional boolean attribute - whether the destination path is created when missing (default is false)</li>
</ul>
<p>That's why for the <strong>DownloadTask</strong> just remains the mandatory attribute <strong>url</strong>. In general any
task should now implement following methods:</p>
<ul>
<li><strong><code>public TaskResult run(TaskParameters parameters)</code></strong> - the run Method is called by the
   task group which can run tasks in order or in parallel. The task parameters contain all data
   required to allow rendering a text with templating context like the document model (when a model
   has been defined), the current matrix attributes (when a matrix has been configured) the current
   task group variables (when variables are given) and the current with context (when list items
   have been defined at the task attribute <strong>with</strong>). You simply can
   call <code>parameters.getTemplatingContext())</code> to get the map that can be easily passed to the
   template engine. The download task allows rendering for the destination path only.
   Important is to call <code>logTitle(parameters);</code> because each task has a title (Component base class)
   allowing to see in the logs what task topic is handled. When something goes wrong the run
   method should define <code>taskResult = new TaskResult(false, getVariable());</code> returning finally
   that task result; first parameter indicates the success of the task. When all is fine the 
   task variable will be modified: <code>getVariable().setValue(renderedDestinationPath.toString());</code>;
   that way further tasks can continue working with the path and filename. For consistency all
   file based tasks should do that. Of course the task result should have <strong>true</strong> then as
   first parameter.</li>
<li><strong><code>public AbstractTask copy()</code> - the copy is important for the situation where the user is
   using the </strong>with** attribute. The problem is here that the task is defined once but executed
   as often as many items are in the list. Since we can run tasks in order or in parallel this
   should also apply for that situation and related to the fact that we also then would have just
   one variable the task will be copied.</li>
<li><strong><code>public String toString()</code></strong> - the main purpose here is using it for the unit testing
   using a task for <strong>@Parameterized</strong> tests. Read here: <a href="../junit5/">Junit5</a>. </li>
</ul>
<p>In general provide reasonable logging that a user can see what is going on (especially when
something goes wrong).</p>
<h2 id="implementing-the-task-creator">Implementing the task creator</h2>
<p><span class="graphviz-light-dark" data-dark="#ffffff" data-default="#789abc" data-library-default="#789abc" data-light="#000000"></span><svg class="graphviz dot" height="44pt" viewbox="0.00 0.00 907.00 44.00" width="907pt" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g class="graph" id="graph0" transform="scale(1 1) rotate(0) translate(4 40)"><title>G</title><polygon fill="transparent" points="-4,4 -4,-40 903,-40 903,4 -4,4" stroke="transparent"></polygon><!-- DownloadTaskCreator --><g class="node" id="node1"><title>DownloadTaskCreator</title><polygon fill="orange" points="691,-36 517,-36 517,0 691,0 691,-36" stroke="#789abc"></polygon><text fill="#789abc" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="604" y="-14.3">DownloadTaskCreator</text></g><!-- DownloadTask --><g class="node" id="node4"><title>DownloadTask</title><polygon fill="none" points="899,-36 780,-36 780,0 899,0 899,-36" stroke="#789abc"></polygon><text fill="#789abc" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="839.5" y="-14.3">DownloadTask</text></g><!-- DownloadTaskCreator&#45;&gt;DownloadTask --><g class="edge" id="edge3"><title>DownloadTaskCreator-&gt;DownloadTask</title><path d="M691.28,-18C717.09,-18 745.03,-18 769.56,-18" fill="none" stroke="#789abc" stroke-dasharray="5,2"></path><polygon fill="#789abc" points="769.85,-21.5 779.85,-18 769.85,-14.5 769.85,-21.5" stroke="#789abc"></polygon><text fill="#789abc" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="735.5" y="-21.8">creates</text></g><!-- ICreator --><g class="node" id="node2"><title>ICreator</title><polygon fill="none" points="194,-36 0,-36 0,0 194,0 194,-36" stroke="#789abc"></polygon><text fill="#789abc" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="97" y="-14.3">ICreator&lt;AbstractTask&gt;</text></g><!-- ITaskCreator --><g class="node" id="node3"><title>ITaskCreator</title><polygon fill="none" points="396,-36 287,-36 287,0 396,0 396,-36" stroke="#789abc"></polygon><text fill="#789abc" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="341.5" y="-14.3">ITaskCreator</text></g><!-- ICreator&#45;&gt;ITaskCreator --><g class="edge" id="edge1"><title>ICreator-&gt;ITaskCreator</title><path d="M204.22,-18C232.72,-18 262.36,-18 286.68,-18" fill="none" stroke="#789abc"></path><polygon fill="#789abc" points="204.19,-14.5 194.19,-18 204.19,-21.5 204.19,-14.5" stroke="#789abc"></polygon><text fill="#789abc" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="240.5" y="-21.8">extends</text></g><!-- ITaskCreator&#45;&gt;DownloadTaskCreator --><g class="edge" id="edge2"><title>ITaskCreator-&gt;DownloadTaskCreator</title><path d="M406.22,-18C439.52,-18 480.75,-18 516.85,-18" fill="none" stroke="#789abc"></path><polygon fill="#789abc" points="406.16,-14.5 396.16,-18 406.16,-21.5 406.16,-14.5" stroke="#789abc"></polygon><text fill="#789abc" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="456.5" y="-21.8">implements</text></g></g></svg></p>
<p>The creator class is very easy and very small in its implementation. The main purpose 
are two things:</p>
<ul>
<li>The class implements <code>public AbstractTask create()</code> to provide a new instance of 
   class <strong>DownloadTask</strong>.</li>
<li>An annotation <code>@Named(TaskType.Constants.DOWNLOAD)</code> binds the creator to a concrete constant
   which is later on important for the <strong>factory</strong>. The Java <strong>SPI</strong> (Service Provider Interface)
   allows loading registered classed for a concrete interface. In this case for the <strong>ITaskCreator</strong>
   interface there is <strong>magic.systems.hyperion.components.tasks.creator.ITaskCreator</strong> file under
   <strong>src/main/resources/META-INF/services</strong> containing a flat list of classes implementing this
   interface. It necessary to add <strong>magic.system.hyperion.reader.creator.DownloadTaskReaderCreator</strong>
   there to allow the <strong>factory</strong> to find the creator by the name defined in the annotation.</li>
</ul>
<h2 id="implementing-the-task-reader">Implementing the task reader</h2>
<p><span class="graphviz-light-dark" data-dark="#ffffff" data-default="#789abc" data-library-default="#789abc" data-light="#000000"></span><svg class="graphviz dot" height="44pt" viewbox="0.00 0.00 982.00 44.00" width="982pt" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g class="graph" id="graph0" transform="scale(1 1) rotate(0) translate(4 40)"><title>G</title><polygon fill="transparent" points="-4,4 -4,-40 978,-40 978,4 -4,4" stroke="transparent"></polygon><!-- DownloadTaskReader --><g class="node" id="node1"><title>DownloadTaskReader</title><polygon fill="orange" points="974,-36 804,-36 804,0 974,0 974,-36" stroke="#789abc"></polygon><text fill="#789abc" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="889" y="-14.3">DownloadTaskReader</text></g><!-- INodeReader --><g class="node" id="node2"><title>INodeReader</title><polygon fill="none" points="110,-36 0,-36 0,0 110,0 110,-36" stroke="#789abc"></polygon><text fill="#789abc" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="55" y="-14.3">INodeReader</text></g><!-- AbstractBasicTaskReader --><g class="node" id="node3"><title>AbstractBasicTaskReader</title><polygon fill="none" points="430,-36 231,-36 231,0 430,0 430,-36" stroke="#789abc"></polygon><text fill="#789abc" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="330.5" y="-14.3">AbstractBasicTaskReader</text></g><!-- INodeReader&#45;&gt;AbstractBasicTaskReader --><g class="edge" id="edge1"><title>INodeReader-&gt;AbstractBasicTaskReader</title><path d="M120.42,-18C153.3,-18 194.01,-18 230.75,-18" fill="none" stroke="#789abc"></path><polygon fill="#789abc" points="120.03,-14.5 110.03,-18 120.03,-21.5 120.03,-14.5" stroke="#789abc"></polygon><text fill="#789abc" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="170.5" y="-21.8">implements</text></g><!-- AbstractFileTaskReader --><g class="node" id="node4"><title>AbstractFileTaskReader</title><polygon fill="none" points="711,-36 523,-36 523,0 711,0 711,-36" stroke="#789abc"></polygon><text fill="#789abc" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="617" y="-14.3">AbstractFileTaskReader</text></g><!-- AbstractBasicTaskReader&#45;&gt;AbstractFileTaskReader --><g class="edge" id="edge2"><title>AbstractBasicTaskReader-&gt;AbstractFileTaskReader</title><path d="M440.51,-18C467.62,-18 496.45,-18 522.73,-18" fill="none" stroke="#789abc"></path><polygon fill="#789abc" points="440.21,-14.5 430.21,-18 440.21,-21.5 440.21,-14.5" stroke="#789abc"></polygon><text fill="#789abc" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="476.5" y="-21.8">extends</text></g><!-- AbstractFileTaskReader&#45;&gt;DownloadTaskReader --><g class="edge" id="edge3"><title>AbstractFileTaskReader-&gt;DownloadTaskReader</title><path d="M721.61,-18C748.77,-18 777.73,-18 803.74,-18" fill="none" stroke="#789abc"></path><polygon fill="#789abc" points="721.3,-14.5 711.3,-18 721.3,-21.5 721.3,-14.5" stroke="#789abc"></polygon><text fill="#789abc" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="757.5" y="-21.8">extends</text></g></g></svg></p>
<p>The reader basically is reading and validating information details from the YAML tree.
The INodeReader provides the interface to accept the current node to be handled.
All task based reader have two information passed from outside:</p>
<ul>
<li><strong>the taskgroup</strong>: where to add the task that has been read and validated</li>
<li><strong>the task creator</strong>: interface to concrete task creator. You can rely on that the
   creator is compatible to the task; so you are allowed to cast to the concrete one.</li>
</ul>
<p>The class hierarchy offers you two functionalities:</p>
<ul>
<li><strong>providing a matcher</strong>: with <code>protected ListMatcher&lt;String&gt; getMatcher(final JsonNode node)</code>
   you are able to implement on each level what fields (attributes) are mandatory and which
   ones are optional to be able to validate. Because the base class handled most things it just
   remains for the DownloadTaskReader to add following:
   <code>matcher.requireExactlyOnce(DocumentReaderFields.URL.getFieldName());</code>.
   The matcher provides a <code>matches</code> method and when that one returns false you can stop reading
   throwing an exception (the YAML format is then wrong).</li>
<li><strong>providing basic read methods</strong>: with <code>readBasic</code> and <code>readFile</code> the base classes already
   initialize the task with the information found.</li>
</ul>
<p>For the DownloadTaskReader it remains to read and validate information for the URL
and finally to add the task to the task group.</p>
<h2 id="implementing-the-task-reader-creator">Implementing the task reader creator</h2>
<p><span class="graphviz-light-dark" data-dark="#ffffff" data-default="#789abc" data-library-default="#789abc" data-light="#000000"></span><svg class="graphviz dot" height="44pt" viewbox="0.00 0.00 1149.00 44.00" width="1149pt" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g class="graph" id="graph0" transform="scale(1 1) rotate(0) translate(4 40)"><title>G</title><polygon fill="transparent" points="-4,4 -4,-40 1145,-40 1145,4 -4,4" stroke="transparent"></polygon><!-- DownloadTaskReaderCreator --><g class="node" id="node1"><title>DownloadTaskReaderCreator</title><polygon fill="orange" points="882,-36 657,-36 657,0 882,0 882,-36" stroke="#789abc"></polygon><text fill="#789abc" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="769.5" y="-14.3">DownloadTaskReaderCreator</text></g><!-- DownloadTaskReader --><g class="node" id="node4"><title>DownloadTaskReader</title><polygon fill="none" points="1141,-36 971,-36 971,0 1141,0 1141,-36" stroke="#789abc"></polygon><text fill="#789abc" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="1056" y="-14.3">DownloadTaskReader</text></g><!-- DownloadTaskReaderCreator&#45;&gt;DownloadTaskReader --><g class="edge" id="edge3"><title>DownloadTaskReaderCreator-&gt;DownloadTaskReader</title><path d="M882.13,-18C908.12,-18 935.55,-18 960.71,-18" fill="none" stroke="#789abc" stroke-dasharray="5,2"></path><polygon fill="#789abc" points="960.97,-21.5 970.97,-18 960.97,-14.5 960.97,-21.5" stroke="#789abc"></polygon><text fill="#789abc" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="926.5" y="-21.8">creates</text></g><!-- ICreator --><g class="node" id="node2"><title>ICreator</title><polygon fill="none" points="283,-36 0,-36 0,0 283,0 283,-36" stroke="#789abc"></polygon><text fill="#789abc" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="141.5" y="-14.3">ICreator&lt;AbstractBasicTaskReader&gt;</text></g><!-- ITaskReaderCreator --><g class="node" id="node3"><title>ITaskReaderCreator</title><polygon fill="none" points="536,-36 376,-36 376,0 536,0 536,-36" stroke="#789abc"></polygon><text fill="#789abc" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="456" y="-14.3">ITaskReaderCreator</text></g><!-- ICreator&#45;&gt;ITaskReaderCreator --><g class="edge" id="edge1"><title>ICreator-&gt;ITaskReaderCreator</title><path d="M293.28,-18C321.79,-18 350.55,-18 375.75,-18" fill="none" stroke="#789abc"></path><polygon fill="#789abc" points="293.21,-14.5 283.21,-18 293.21,-21.5 293.21,-14.5" stroke="#789abc"></polygon><text fill="#789abc" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="329.5" y="-21.8">extends</text></g><!-- ITaskReaderCreator&#45;&gt;DownloadTaskReaderCreator --><g class="edge" id="edge2"><title>ITaskReaderCreator-&gt;DownloadTaskReaderCreator</title><path d="M546.07,-18C580.6,-18 620.53,-18 656.95,-18" fill="none" stroke="#789abc"></path><polygon fill="#789abc" points="546.01,-14.5 536.01,-18 546.01,-21.5 546.01,-14.5" stroke="#789abc"></polygon><text fill="#789abc" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="596.5" y="-21.8">implements</text></g></g></svg></p>
<p>It's very the same procedure as already explained for the task creator. </p>
<ul>
<li>The class implements <code>public AbstractBasicTaskReader create()</code> to provide a new instance of
  class <strong>DownloadTaskReader</strong>. The factory for tasks is used here to search for the concrete
  task creator passing it to the constructor of the reader.</li>
<li>An annotation <code>@Named(TaskType.Constants.DOWNLOAD)</code> binds the creator to a concrete constant
  which is later on important for the <strong>factory</strong>. The Java <strong>SPI</strong> (Service Provider Interface)
  allows loading registered classed for a concrete interface. In this case for the <strong>ITaskReaderCreator</strong>
  interface there is <strong>magic.systems.hyperion.reader.creator.ITaskReaderCreator</strong> file under
  <strong>src/main/resources/META-INF/services</strong> containing a flat list of classes implementing this
  interface. It necessary to add <strong>magic.system.reader.creator.DownloadTaskReaderCreator</strong>
  there to allow the <strong>factory</strong> to find the creator by the name defined in the annotation.</li>
</ul>
<h2 id="testing">Testing</h2>
<p>Now all four classes are created you should be able to process documents with download tasks.
Of course there should be unittests for the task and for the reader. For the reader it is
sufficient to test it in context of reading a document. That's why I implemented following:</p>
<ul>
<li>DownloadTaskTest</li>
<li>DocumentReaderForDownloadTaskTests</li>
</ul></div>
</div>
</div>
<footer class="col-md-12">
<hr/>
<p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
</footer>
<script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
<script defer="" src="../../js/base.js"></script>
<script defer="" src="../../search/main.js"></script>
<div aria-hidden="true" aria-labelledby="searchModalLabel" class="modal" id="mkdocs_search_modal" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg">
<div class="modal-content">
<div class="modal-header">
<h4 class="modal-title" id="searchModalLabel">Search</h4>
<button class="close" data-dismiss="modal" type="button"><span aria-hidden="true">×</span><span class="sr-only">Close</span></button>
</div>
<div class="modal-body">
<p>From here you can search these documents. Enter your search terms below.</p>
<form>
<div class="form-group">
<input class="form-control" id="mkdocs-search-query" placeholder="Search..." title="Type search term here" type="search"/>
</div>
</form>
<div data-no-results-text="No results found" id="mkdocs-search-results"></div>
</div>
<div class="modal-footer">
</div>
</div>
</div>
</div><div aria-hidden="true" aria-labelledby="keyboardModalLabel" class="modal" id="mkdocs_keyboard_modal" role="dialog" tabindex="-1">
<div class="modal-dialog">
<div class="modal-content">
<div class="modal-header">
<h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
<button class="close" data-dismiss="modal" type="button"><span aria-hidden="true">×</span><span class="sr-only">Close</span></button>
</div>
<div class="modal-body">
<table class="table">
<thead>
<tr>
<th style="width: 20%;">Keys</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr>
<td class="help shortcut"><kbd>?</kbd></td>
<td>Open this help</td>
</tr>
<tr>
<td class="next shortcut"><kbd>n</kbd></td>
<td>Next page</td>
</tr>
<tr>
<td class="prev shortcut"><kbd>p</kbd></td>
<td>Previous page</td>
</tr>
<tr>
<td class="search shortcut"><kbd>s</kbd></td>
<td>Search</td>
</tr>
</tbody>
</table>
</div>
<div class="modal-footer">
</div>
</div>
</div>
</div>
</body>
</html>
